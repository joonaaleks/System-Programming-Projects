#include <stdio.h>
#include <stdlib.h>
#include <string.h>

// File reversing program
int main(int argc, char *argv[])
{
    // Check for correct number of arguments
    if (argc != 3)
    {
        fprintf(stderr, "Usage: %s <input file> <output file>\n", argv[0]);
        return 1;
    }

    // Check if input and output files are the same file
    if (strcmp(argv[1], argv[2]) == 0)
    {
        fprintf(stderr, "Error: Input and output file must differ\n");
        return 1;
    }

    // Open input file
    FILE *file = fopen(argv[1], "r");
    if (file == NULL)
    {
        fprintf(stderr, "error: cannot open file %s\n", file);
        return 1;
    }

    // Get file size
    fseek(file, 0, SEEK_END);
    int size = ftell(file);
    fseek(file, 0, SEEK_SET);

    // Allocate memory for file
    char *buffer = malloc(size);
    if (buffer == NULL)
    {
        fprintf(stderr, "malloc failed\n");
        return 1;
    }

    // Read file into buffer
    fread(buffer, 1, size, file);

    // Close file
    fclose(file);

    // Reverse buffer
    int i = 0;
    int j = size - 1;
    while (i < j)
    {
        char temp = buffer[i];
        buffer[i] = buffer[j];
        buffer[j] = temp;
        i++;
        j--;
    }

    // Open output file
    file = fopen(argv[2], "w");
    if (file == NULL)
    {
        fprintf(stderr, "error: cannot open file\n");
        return 1;
    }

    // Write buffer to file
    fwrite(buffer, 1, size, file);

    // Close file
    fclose(file);

    // Free memory
    free(buffer);

    return 0;
}